# Monitoring Guide

Monitor nodes, tasks, and resources via CLI and web dashboard.

---

## CLI Monitoring

### Nodes

```bash
kohakuriver node list              # All nodes with status, cores, GPUs
kohakuriver status                 # Quick cluster overview
```

### Tasks

```bash
kohakuriver task list              # List all tasks
kohakuriver task list -s running   # Filter by status
kohakuriver task status <id>       # Detailed task info
kohakuriver task logs <id>         # View task output
kohakuriver task watch <id>        # Real-time log streaming
```

### VPS

```bash
kohakuriver vps list               # Active VPS instances
kohakuriver vps status <id>        # VPS details with SSH port
```

---

## Web Dashboard Monitoring

| View | Monitors |
|------|----------|
| **Home** | Cluster-wide CPU/memory, task counts |
| **Nodes** | Per-node status, resources, NUMA |
| **GPUs** | Per-GPU utilization, temp, memory |
| **Tasks** | Task status, logs, actions |
| **VPS** | SSH ports, status |

---

## System Logs

```bash
# Host logs
journalctl -u kohakuriver-host -f

# Runner logs
journalctl -u kohakuriver-runner -f
```

### Task Logs

- **Location:** `<shared_dir>/task_outputs/<task_id>.out`, `<shared_dir>/task_errors/<task_id>.err`
- **CLI:** `kohakuriver task logs <id>`
- **Dashboard:** Task details modal

---

## Resource Monitoring

| Resource | How to Monitor |
|----------|----------------|
| CPU/Memory | `kohakuriver node list`, Dashboard Home/Nodes |
| GPU | `kohakuriver node list`, Dashboard GPUs view |
| Disk | `df -h <shared_dir>`, `df -h /var/lib/docker` |

---

## Log Interpretation

### Common Log Messages

| Message | Meaning |
|---------|---------|
| `Runner registered` | Runner connected to Host |
| `Heartbeat timeout` | Runner went offline |
| `Task assigned` | Task dispatched to Runner |
| `Container sync` | Runner downloading tarball |
| `Exit code: 0` | Task completed successfully |
| `Exit code: N` | Task failed with error |

### Debug Steps

1. Check task status: `kohakuriver task status <id>`
2. View task logs: `kohakuriver task logs <id>`
3. Check Runner logs: `journalctl -u kohakuriver-runner`
4. Check Host logs: `journalctl -u kohakuriver-host`

---

## External Alerting

KohakuRiver has no built-in alerting. Integrate with external tools:

```bash
# Example: cron script to check offline nodes
kohakuriver node list | grep offline && send_alert "Node offline"
```

Integration options: Prometheus exporters, Nagios checks, custom scripts.
