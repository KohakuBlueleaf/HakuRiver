# Installation Guide

This guide walks you through the process of installing HakuRiver on your host machine, runner nodes, and client machines.

## Prerequisites

Before installing HakuRiver, ensure your infrastructure meets these requirements:

### Hardware Requirements
- **Host Node**: Any machine capable of running Python and Docker
- **Runner Nodes**: Compute machines with sufficient resources for your tasks
- **Shared Storage**: A filesystem accessible from all nodes at the same path
- **Network**: All nodes must be able to communicate with each other

### Software Requirements
- **Python**: Version 3.10 or newer on all machines
- **Docker Engine**: Installed on both the Host and all Runner nodes
- **Shared Filesystem**: NFS, Samba, or any other shared filesystem solution
- **Sudo Access**: Runner nodes may require passwordless sudo for certain operations

### Docker Configuration
HakuRiver uses Docker's default configuration, but you should verify:
1. Docker daemon is running
2. Your user has permissions to use Docker (usually by being in the `docker` group)
3. Docker storage driver and data-root are properly configured

You can verify Docker is working with:
```bash
docker run hello-world
```

## Installation Methods

### Option 1: Install via pip (Recommended)

The simplest way to install HakuRiver is using pip:

```bash
python -m pip install hakuriver
```

This will install the latest stable version from PyPI.

### Option 2: Install from GitHub

To install the latest development version directly from GitHub:

```bash
python -m pip install git+https://github.com/KohakuBlueleaf/HakuRiver.git
```

### Option 3: Manual Installation from Source

You can also clone the repository and install locally:

```bash
git clone https://github.com/KohakuBlueleaf/HakuRiver.git
cd HakuRiver
pip install .
```

## Post-Installation Configuration

After installing HakuRiver, you need to create the default configuration file:

```bash
hakuriver.init config
```

This creates a configuration file at `~/.hakuriver/config.toml` which you'll need to customize:

```bash
vim ~/.hakuriver/config.toml
```

### Critical Configuration Settings

Be sure to adjust these settings on all machines:

1. **Networking**:
   - `host_reachable_address`: Set to the Host's IP or hostname accessible by Runners/Clients
   - `runner_address`: Set to the Runner's IP or hostname accessible by the Host
   - `host_port` and `runner_port`: Default is 8000 and 8001, change if needed

2. **Shared Directory**:
   - `shared_dir`: Absolute path to your shared storage (must be the same path on all machines)

3. **Systemd and NUMA** (if used):
   - `numactl_path`: Path to `numactl` binary if using NUMA features

## Installation Testing

After installation, verify that HakuRiver is properly installed by running:

```bash
hakuriver.client --help
```

You should see the help message for the client command.

## Setting Up Systemd Services (Optional)

For production use, you may want to run HakuRiver components as systemd services:

```bash
# On the host machine
hakuriver.init service --host --config /path/to/host.toml
sudo systemctl enable --now hakuriver-host.service

# On each runner node
hakuriver.init service --runner --config /path/to/runner.toml
sudo systemctl enable --now hakuriver-runner.service
```

This creates systemd service files and starts the services.

## Example Configuration Workflow

1. **Install on Host**:
   ```bash
   pip install hakuriver
   hakuriver.init config
   # Edit ~/.hakuriver/config.toml
   ```

2. **Install on Runners**:
   ```bash
   pip install hakuriver
   hakuriver.init config
   # Edit ~/.hakuriver/config.toml
   ```

3. **Create shared directory**:
   ```bash
   # On a shared storage server or the host
   mkdir -p /shared/hakuriver
   # Ensure it's mounted at the same path on all nodes
   ```

4. **Start Services**:
   ```bash
   # On Host
   hakuriver.host

   # On Runners
   hakuriver.runner
   ```

## Next Steps

Now that you have installed HakuRiver, proceed to the [Quick Start Guide](quick-start.md) to learn how to use it.

## Troubleshooting

If you encounter issues during installation:

1. Verify Python version: `python --version` (should be 3.10+)
2. Verify Docker installation: `docker info`
3. Check shared directory is accessible on all nodes
4. Ensure network connectivity between Host and Runners
5. Check logs for detailed error messages:
   - Host logs: `journalctl -u hakuriver-host.service` (if using systemd)
   - Runner logs: `journalctl -u hakuriver-runner.service` (if using systemd)

For more help, refer to the [Troubleshooting](../troubleshooting/common-issues.md) section.