# Client Command Reference (`hakuriver.client`)

The `hakuriver.client` command is the primary tool for interacting with the HakuRiver cluster to submit tasks, check status, and manage nodes.

## Usage

```bash
hakuriver.client [OPTIONS] [--] [COMMAND] [ARGS...]
```

*   `OPTIONS`: Flags that control the client's behavior (e.g., targeting, resources).
*   `--`: Optional separator. Everything after `--` is treated as the command and its arguments to be executed on the target(s). If the command itself starts with `-`, the `--` is recommended.
*   `COMMAND [ARGS...]`: The command and its arguments to run on the target node(s).

## Options

### Configuration

*   `--config PATH`
    *   Specify the path to a custom TOML configuration file. Overrides settings found in the default location (`~/.hakuriver/config.toml`).

### Task Submission Options

These options are used when submitting a new command to the cluster.

*   `--target HOST[:NUMA_ID]`
    *   Specifies the target node(s) for the task. Can be repeated to submit the same task to multiple nodes.
    *   `HOST`: The hostname of a registered Runner node.
    *   `NUMA_ID` (optional): The integer ID of a specific NUMA node on the target host. This only has an effect if `--container NULL` is used (systemd execution). Ignored for Docker tasks currently.
    *   **Required** for task submission.
    *   Examples: `--target compute01`, `--target compute02:0`, `--target nodeA --target nodeB`
*   `--cores N` (integer, default: 1)
    *   The number of CPU cores the task requires *per target*. The Host uses this for basic scheduling checks (currently not strict enforcement but planned). Set to `0` to indicate no specific core requirement (scheduler might still default to 1).
*   `--memory SIZE` (string, default: None)
    *   The memory limit for the task *per target*. Uses standard suffixes like `K`, `M`, `G`. If no suffix, assumes bytes.
    *   Examples: `--memory 512M`, `--memory 4G`, `--memory 1024K`, `--memory 8000000000`
*   `--env KEY=VALUE`
    *   Set an environment variable within the task's execution environment. Can be repeated multiple times.
    *   Example: `--env MY_VAR=hello --env PATH_EXTRA=/opt/myapp/bin`
*   `--container NAME` (string, default: uses `default_container_name` from config)
    *   The name of the HakuRiver Docker environment (tarball) to use for running the task. Corresponds to the name used with `hakuriver.docker create-tar`.
    *   Set to `NULL` (case-sensitive string "NULL") to bypass Docker and run the task directly on the host using the systemd fallback mechanism (requires appropriate permissions and `numactl` if NUMA targeting is used).
    *   Example: `--container my-python-env`, `--container NULL`
*   `--privileged` (boolean flag)
    *   If specified, runs the Docker task container with the `--privileged` flag. Overrides the `tasks_privileged` setting in the configuration file. Use with extreme caution.
*   `--mount HOST_PATH:CONTAINER_PATH`
    *   Mount an additional directory from the host into the Docker container. Can be repeated. Overrides the `additional_mounts` setting in the configuration file.
    *   Example: `--mount /data/input:/mnt/input --mount /data/output:/mnt/output`
*   `--wait` (boolean flag)
    *   If specified, the client will wait for the submitted task(s) to reach a final state (completed, failed, killed, lost) before exiting. It polls the Host periodically.
*   `--poll-interval SEC` (integer, default: 1)
    *   When using `--wait`, specifies the interval in seconds between status checks.

### Cluster Management Options

These options perform actions other than task submission. They are mutually exclusive with each other and with task submission.

*   `--status TASK_ID`
    *   Check and display the detailed status of a specific task identified by its `TASK_ID`.
*   `--kill TASK_ID`
    *   Request the Host to terminate a running or pending task identified by its `TASK_ID`.
*   `--list-nodes`
    *   List all registered Runner nodes, their status (online/offline), total cores, available cores, and NUMA summary.
*   `--health [HOSTNAME]`
    *   Display detailed health and resource usage information.
    *   If `HOSTNAME` is provided, shows details for that specific node.
    *   If `HOSTNAME` is omitted, shows aggregate health and status for all registered nodes.

### Other Actions (via direct command)

While not dedicated flags, you can manage tasks like pause/resume by submitting specific commands *if* the runner supports them via a `/command/{task_id}/{command}` endpoint (as seen in the code).

*   Pause a task (if supported):
    ```bash
    hakuriver.client pause <task_id>
    ```
*   Resume a task (if supported):
    ```bash
    hakuriver.client resume <task_id>
    ```
    *(Note: The current `client.py` doesn't have dedicated `pause`/`resume` flags, but the structure allows adding subcommands or recognizing these keywords if needed. The examples in the main README suggest this might be intended via the command mechanism).*

## Examples

**1. Submit a simple command to node1 using the default container:**

```bash
hakuriver.client --target node1 -- echo "Hello from HakuRiver!"
```

**2. Run a Python script in a custom environment on node2, requesting resources:**

```bash
hakuriver.client --target node2 --container my-py311-env --cores 4 --memory 8G -- \
  python /shared/scripts/process_data.py --input /shared/input/data.csv
```

**3. Run a command on multiple nodes:**

```bash
hakuriver.client --target node1 --target node3 --target node4 -- hostname
```

**4. Run a command directly on node1 (systemd fallback) targeting NUMA node 0:**

```bash
hakuriver.client --target node1:0 --container NULL -- ./run_benchmark.sh --numa-aware
```

**5. Check the status of a task:**

```bash
hakuriver.client --status 1234567890123456789
```

**6. List all nodes:**

```bash
hakuriver.client --list-nodes
```

**7. Submit a task and wait for it to finish:**

```bash
hakuriver.client --target node1 --wait -- ./long_simulation --param value
```

**8. Kill a task:**

```bash
hakuriver.client --kill 9876543210987654321
```

**9. Get health for a specific node:**

```bash
hakuriver.client --health compute05
```