# Configuration Reference (`config.toml`)

HakuRiver uses a TOML configuration file to manage settings for the Host, Runner, and Client components. This reference details the available options.

**Default Location:** `~/.hakuriver/config.toml`

You can override the default location using the `--config /path/to/custom.toml` flag with any `hakuriver.*` command.

## Sections

### `[network]`

Network settings for communication between components.

*   `host_bind_ip` (string, default: `"0.0.0.0"`)
    *   The IP address the **Host** server binds to for listening. `0.0.0.0` makes it listen on all available network interfaces.
*   `host_port` (integer, default: `8000`)
    *   The TCP port the **Host** server listens on.
*   `host_reachable_address` (string, **CRITICAL**, default: `"127.0.0.1"`)
    *   The IP address or hostname that **Runners** and **Clients** use to connect to the Host server. **Must be changed** in a multi-machine setup to the actual reachable IP/hostname of the Host node.
*   `runner_address` (string, **CRITICAL**, default: `"127.0.1.1"`)
    *   The IP address or hostname that the **Host** uses to connect back to this **Runner** agent (e.g., for sending kill signals). **Must be changed** on each Runner node to its own reachable IP/hostname.
*   `runner_port` (integer, default: `8001`)
    *   The TCP port the **Runner** agent listens on.

### `[paths]`

Filesystem paths used by HakuRiver.

*   `shared_dir` (string, **CRITICAL**, default: `"test/shared"`)
    *   The **absolute path** to the shared filesystem directory mounted on **all** nodes (Host and Runners). This directory stores container tarballs, task output logs (`*.out`), task error logs (`*.err`), and potentially user data/scripts. Ensure it exists and is writable by the HakuRiver user on all relevant nodes.
*   `local_temp_dir` (string, default: `"test/temp"`)
    *   The **absolute path** to a local temporary directory on each **Runner** node. This should ideally be on fast storage (like an SSD or NVMe). It is mounted into containers as `/local_temp` and the path is provided via the `HAKURIVER_LOCAL_TEMP_DIR` environment variable within tasks. Ensure it exists and is writable by the HakuRiver user on Runner nodes.
*   `numactl_path` (string, default: `""`)
    *   The **absolute path** to the `numactl` executable on **Runner** nodes. Only required if you intend to use the NUMA targeting feature (`--target node:numa_id`) with the systemd fallback execution method (`--container NULL`). If empty or not found, NUMA targeting for systemd tasks will be disabled.
*   `host_log_file` (string, default: `"host.log"`)
    *   Optional: Path to the log file for the **Host** server. If empty, logs go to the console (stdout/stderr). Relative paths are relative to where the host is started.
*   `runner_log_file` (string, default: `"runner.log"`)
    *   Optional: Path to the log file for the **Runner** agent. If empty, logs go to the console. The runner will automatically append its hostname before the `.log` extension (e.g., `runner-compute01.log`). Relative paths are relative to where the runner is started.

### `[database]`

Host server database settings.

*   `db_file` (string, default: `"test/cluster_management.db"`)
    *   Path to the SQLite database file used by the **Host** server to store node and task information. Ensure the directory exists and is writable by the user running the Host server.

### `[timing]`

Timing and interval settings.

*   `heartbeat_interval` (integer, default: `5`)
    *   Interval in seconds at which **Runners** send heartbeat signals to the Host.
*   `heartbeat_timeout_factor` (integer, default: `6`)
    *   Multiplier for `heartbeat_interval`. A Runner is marked 'offline' if no heartbeat is received for `heartbeat_interval * heartbeat_timeout_factor` seconds.
*   `cleanup_check_interval` (integer, default: `10`)
    *   Interval in seconds at which the **Host** checks for offline runners and potentially cleans up related state.
*   `resource_check_interval` (integer, default: `1`)
    *   Interval in seconds for internal resource monitoring checks (used by Runner).

### `[environment]`

Settings related to the execution environment.

*   `runner_user` (string, default: `""`)
    *   Optional: Specify the system username under which tasks should be run by the **Runner** when using the systemd fallback (`--container NULL`). If empty, tasks run as the user who started the `hakuriver.runner` process. **Note:** The Runner process itself might still need specific permissions (e.g., passwordless sudo for `systemd-run`).

### `[docker]`

Settings related to Docker container management and execution.

*   `container_dir` (string, default: `"hakuriver-containers"`)
    *   The name of the subdirectory within `shared_dir` where HakuRiver container tarballs are stored (e.g., `<shared_dir>/hakuriver-containers/`).
*   `default_container_name` (string, default: `"hakuriver-base"`)
    *   The default HakuRiver environment name used for tasks if the `--container` flag is not specified during submission. The corresponding image will be `hakuriver/hakuriver-base:base`.
*   `initial_base_image` (string, default: `"python:3.12.10-alpine3.21"`)
    *   The public Docker image (e.g., from Docker Hub) used by the **Host** to automatically create the *initial* tarball for the `default_container_name` *only* if no tarball for that name exists in the `container_dir` when the Host starts. Ignored if a tarball already exists.
*   `tasks_privileged` (boolean, default: `false`)
    *   Default setting for whether tasks run inside Docker containers should use the `--privileged` flag. This can be overridden per task using the `--privileged` flag in `hakuriver.client`. Use with caution as it grants extensive host access to the container.
*   `additional_mounts` (array of strings, default: `[]`)
    *   A list of default host-to-container directory mounts applied to **all** Docker tasks. Each string must be in the format `"host_path:container_path"`. This can be overridden per task using the `--mount` flag in `hakuriver.client`. Example: `["/data/shared:/shared_data", "/scratch:/local_scratch"]`.