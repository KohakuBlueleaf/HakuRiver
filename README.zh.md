# HakuRiver - å…±äº«å®¹å™¨å¢é›†

| English | ä¸­æ–‡ (ä½ åœ¨é€™) |
| :------ | :--- |
| [English](./README.md) | [ä¸­æ–‡](./README.zh.md) |

[![æˆæ¬Š](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

![HakuRiver logo svg](image/logo.svg)

***æ­¤å°ˆæ¡ˆä»è™•æ–¼å¯¦é©—éšæ®µï¼Œä½¿ç”¨é¢¨éšªè‡ªè² ***

**HakuRiver** æ˜¯ä¸€å€‹è¼•é‡ç´šã€è‡ªè¨—ç®¡çš„å¢é›†ç®¡ç†ç³»çµ±ï¼Œå°ˆç‚ºåœ¨è¨ˆç®—ç¯€é»é–“åˆ†é…å‘½ä»¤åˆ—ä»»å‹™è€Œè¨­è¨ˆã€‚å®ƒä¸»è¦åˆ©ç”¨ **Docker** ä¾†ç®¡ç†å¯é‡ç¾çš„ä»»å‹™ç’°å¢ƒï¼Œè®“ä½¿ç”¨è€…èƒ½å°‡å®¹å™¨è¦–ç‚ºä¾¿æ”œå¼ã€Œè™›æ“¬ç’°å¢ƒã€ã€‚HakuRiver å”èª¿é€™äº›å®¹å™¨åŒ–ç’°å¢ƒçš„å»ºç«‹ã€æ‰“åŒ…ï¼ˆé€šé tarballï¼‰ã€åˆ†ç™¼å’Œåœ¨ç¯€é»é–“çš„åŸ·è¡Œã€‚

å®ƒæä¾›è³‡æºåˆ†é…ï¼ˆCPU/è¨˜æ†¶é«”é™åˆ¶ï¼‰ã€å¤šç¯€é»/NUMA ä»»å‹™æäº¤å’Œç‹€æ…‹è¿½è¹¤åŠŸèƒ½ï¼Œéå¸¸é©åˆç ”ç©¶å¯¦é©—å®¤ã€ä¸­å°å‹åœ˜éšŠã€å®¶åº­å¯¦é©—å®¤æˆ–é–‹ç™¼ç’°å¢ƒï¼Œé€™äº›ç’°å¢ƒéœ€è¦ç°¡å–®ã€å¯é‡ç¾çš„åˆ†æ•£å¼ä»»å‹™åŸ·è¡Œï¼Œè€Œä¸éœ€æ‰¿æ“”è¤‡é›œ HPC æ’ç¨‹å™¨çš„é¡å¤–è² æ“”ã€‚


## HakuRiver ç°¡ä»‹

### å•é¡ŒèƒŒæ™¯

ç ”ç©¶äººå“¡å’Œå°å‹åœ˜éšŠåœ¨ä½¿ç”¨å°‘é‡è¨ˆç®—ç¯€é»ï¼ˆé€šå¸¸ 3-8 å°æ©Ÿå™¨ï¼‰æ™‚ï¼Œç¶“å¸¸é¢è‡¨å°·å°¬çš„ä¸­é–“åœ°å¸¶ï¼š

- **æ©Ÿå™¨å¤ªå¤š**ï¼Œç„¡æ³•æœ‰æ•ˆåœ°é€é SSH å’Œ Shell è…³æœ¬æ‰‹å‹•ç®¡ç†
- **æ©Ÿå™¨å¤ªå°‘**ï¼Œé›£ä»¥æ¥å—éƒ¨ç½²è¤‡é›œ HPC æ’ç¨‹å™¨ï¼ˆå¦‚ Slurmï¼‰çš„é¡å¤–é–‹éŠ·
- **å®¹å™¨ç·¨æ’ç³»çµ±**ï¼ˆå¦‚ Kubernetesï¼‰å°æ–¼ç°¡å–®çš„ä»»å‹™åˆ†ç™¼è€Œè¨€**éæ–¼è¤‡é›œ**

æ‚¨æ“æœ‰é€™äº›å¼·å¤§çš„è¨ˆç®—è³‡æºï¼Œå»æ²’æœ‰é«˜æ•ˆæ–¹æ³•åœ¨ä¸å¢åŠ å¤§é‡é‹ç¶­é–‹éŠ·çš„æƒ…æ³ä¸‹ï¼Œå°‡å®ƒå€‘ä½œç‚ºçµ±ä¸€çš„è¨ˆç®—è³‡æºä½¿ç”¨ã€‚

### æ ¸å¿ƒæ¦‚å¿µï¼šå°‡ç¯€é»è¦–ç‚ºä¸€å°å¤§å‹é›»è…¦

HakuRiver é€šéä»¥ä¸‹é—œéµè¨­è¨ˆåŸå‰‡ï¼Œè®“æ‚¨å°‡å°å‹å¢é›†è¦–ç‚ºå–®ä¸€å¼·å¤§é›»è…¦ï¼š

- **è¼•é‡ç´šè³‡æºç®¡ç†**ï¼šä»¥æœ€å°‘çš„è¨­ç½®åœ¨ç¯€é»é–“åˆ†ç™¼å‘½ä»¤åˆ—ä»»å‹™
- **ç’°å¢ƒä¸€è‡´æ€§**ï¼šä½¿ç”¨ Docker å®¹å™¨ä½œç‚ºå¯æ”œå¼è™›æ“¬ç’°å¢ƒï¼Œè€Œéè¤‡é›œçš„æ‡‰ç”¨éƒ¨ç½²
- **ç„¡ç¸«åŒæ­¥**ï¼šè‡ªå‹•å°‡å®¹å™¨ç’°å¢ƒåˆ†ç™¼åˆ°åŸ·è¡Œç¯€é»ï¼Œç„¡éœ€åœ¨æ¯å€‹ç¯€é»ä¸Šæ‰‹å‹•è¨­ç½®
- **ç†Ÿæ‚‰çš„å·¥ä½œæµç¨‹**ï¼šé€šéç°¡å–®çš„ä»‹é¢æäº¤ä»»å‹™ï¼Œå°±åƒåœ¨æœ¬åœ°æ©Ÿå™¨é‹è¡Œå‘½ä»¤ä¸€æ¨£

> HakuRiver ä¸­çš„ Docker ä½œç‚ºä¸€ç¨®å¯å‹•æ…‹èª¿æ•´å’Œè‡ªå‹•åŒæ­¥çš„è™›æ“¬ç’°å¢ƒã€‚æ‚¨å¯ä»¥é‹è¡Œæ•¸åå€‹ä½¿ç”¨ç›¸åŒå®¹å™¨ç’°å¢ƒçš„ä»»å‹™ï¼Œä½†åœ¨å®Œå…¨ä¸åŒçš„ç¯€é»ä¸ŠåŸ·è¡Œå®ƒå€‘ã€‚

### é‹ä½œåŸç†

1. **ç’°å¢ƒç®¡ç†**ï¼šé€éäº’å‹•å¼ Shell åœ¨ç®¡ç†ç¯€é»ä¸Šå»ºç«‹å’Œè‡ªå®šç¾© Docker å®¹å™¨
2. **æ‰“åŒ…èˆ‡åˆ†ç™¼**ï¼šç’°å¢ƒæ‰“åŒ…ç‚º tarball ä¸¦å­˜å„²åœ¨å…±äº«å­˜å„²ä¸­
3. **è‡ªå‹•åŒæ­¥**ï¼šåŸ·è¡Œç¯€é»åœ¨åŸ·è¡Œä»»å‹™å‰è‡ªå‹•ç²å–æ‰€éœ€ç’°å¢ƒ
4. **ä¸¦è¡ŒåŸ·è¡Œ**ï¼šæäº¤å–®ä¸€å‘½ä»¤æˆ–æ‰¹æ¬¡åœ¨å¤šå€‹ç¯€é»ä¸Šé‹è¡Œï¼Œæ¯å€‹ä»»å‹™åœ¨è‡ªå·±çš„å®¹å™¨å¯¦ä¾‹ä¸­éš”é›¢

é€™ç¨®æ–¹æ³•ç¬¦åˆä»¥ä¸‹ç†å¿µï¼š

> å°æ–¼å°å‹æœ¬åœ°å¢é›†ï¼Œæ‡‰å„ªå…ˆé¸æ“‡ã€Œè¼•é‡ã€ç°¡å–®ã€æ°å¥½è¶³å¤ ã€çš„è§£æ±ºæ–¹æ¡ˆã€‚æ‚¨ä¸éœ€è¦å°‡æ¯å€‹å‘½ä»¤æ‰“åŒ…æˆè¤‡é›œçš„ Dockerfile - Docker åœ¨é€™è£¡çš„ç›®çš„æ˜¯ç’°å¢ƒç®¡ç†å’ŒåŒæ­¥ã€‚

HakuRiver å»ºç«‹åœ¨å°å‹æœ¬åœ°å¢é›†çš„å¯¦éš›å‡è¨­åŸºç¤ä¸Šï¼š

- ç¯€é»å¯ä»¥è¼•æ˜“å»ºç«‹ç¶²çµ¡é€šè¨Š
- å…±äº«å­˜å„²éš¨æ™‚å¯ç”¨
- ç„¡é ˆèªè­‰ç³»çµ±æˆ–èªè­‰è¤‡é›œæ€§å¯ä»¥æœ€å°åŒ–
- åœ¨é€™ç¨®è¦æ¨¡ä¸‹ï¼Œé«˜å¯ç”¨æ€§å’Œå®¹éŒ¯èƒ½åŠ›ä¸é‚£éº¼é—œéµ

é€šéå°ˆæ³¨æ–¼å°è¦æ¨¡è¨ˆç®—çš„å¯¦éš›éœ€æ±‚ï¼ŒHakuRiver æä¾›äº†å¤šç¯€é»ä»»å‹™åŸ·è¡Œçš„ã€Œæ°åˆ°å¥½è™•ã€è§£æ±ºæ–¹æ¡ˆï¼Œç„¡éœ€æ‰¿æ“”ä¼æ¥­ç´šç³»çµ±çš„ç®¡ç†è² æ“”ã€‚

---

## ğŸ¤” HakuRiver é©ç”¨èˆ‡ä¸é©ç”¨çš„å ´æ™¯

| HakuRiver é©ç”¨æ–¼...                                                                                                             | HakuRiver ä¸é©ç”¨æ–¼...                                                                                                                    |
| :------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------- |
| âœ… ç®¡ç†å°å‹å¢é›†ä¸­çš„å‘½ä»¤åˆ—ä»»å‹™/æŒ‡ä»¤ç¢¼ï¼ˆé€šå¸¸ < 10-20 å€‹ç¯€é»ï¼‰ã€‚                                                                   | âŒ æ›¿ä»£å¤§å‹å¢é›†ä¸ŠåŠŸèƒ½è±å¯Œçš„ HPC æ’ç¨‹å™¨ï¼ˆå¦‚ Slurmã€PBSã€LSFï¼‰ã€‚                                                                         |
| âœ… **åœ¨å¯é‡ç¾çš„ Docker å®¹å™¨ç’°å¢ƒä¸­åŸ·è¡Œä»»å‹™ã€‚**                                                                                      | âŒ å”èª¿è¤‡é›œçš„å¤šæœå‹™æ‡‰ç”¨ç¨‹å¼ï¼ˆå¦‚ Kubernetes æˆ– Docker Composeï¼‰ã€‚                                                                        |
| âœ… **åœ¨å®¿ä¸»æ©Ÿä¸Šé€²è¡Œäº’å‹•å¼ç’°å¢ƒè¨­ç½®ï¼Œä¸¦å°‡é€™äº›ç’°å¢ƒæ‰“åŒ…ç‚ºä¾¿æ”œå¼ tarball é€²è¡Œåˆ†ç™¼ã€‚**                                                    | âŒ è‡ªå‹•ç®¡ç†å®¹å™¨*å…§éƒ¨*çš„è¤‡é›œè»Ÿé«”ç›¸ä¾æ€§ï¼ˆä½¿ç”¨è€…é€šéå®¿ä¸»æ©Ÿçš„ shell è¨­ç½®ç’°å¢ƒï¼‰ã€‚                                                          |
| âœ… **æ–¹ä¾¿åœ°åœ¨ç¯€é»/NUMA å€åŸŸé–“æäº¤ç¨ç«‹çš„å‘½ä»¤åˆ—ä»»å‹™æˆ–æ‰¹æ¬¡ä¸¦è¡Œä»»å‹™ã€‚**                                                              | âŒ è¤‡é›œçš„ä»»å‹™ç›¸ä¾æ€§ç®¡ç†æˆ–å·¥ä½œæµç¨‹å”èª¿ï¼ˆè«‹ä½¿ç”¨ Airflowã€Prefectã€Snakemakeã€Nextflowï¼‰ã€‚                                                  |
| âœ… å€‹äººã€ç ”ç©¶å¯¦é©—å®¤ã€å°å‹åœ˜éšŠæˆ–å®¶åº­å¯¦é©—å®¤éœ€è¦*ç°¡å–®*çš„å¤šç¯€é»ä»»å‹™ç®¡ç†ç³»çµ±ã€‚                                                          | âŒ éƒ¨ç½²æˆ–ç®¡ç†é«˜åº¦å¯ç”¨ã€ä»»å‹™é—œéµå‹çš„ç”Ÿç”¢*æœå‹™*ã€‚                                                                                               |
| âœ… æä¾›è¼•é‡ç´šç³»çµ±ï¼Œåœ¨å—æ§ç’°å¢ƒä¸­åˆ†æ•£å¼åŸ·è¡Œä»»å‹™æ™‚éœ€è¦æœ€å°‘çš„ç¶­è­·é–‹éŠ·ã€‚                                                            | âŒ éœ€è¦å¼·å¤§å…§å»ºèªè­‰å’Œæˆæ¬Šå±¤çš„é«˜å®‰å…¨æ€§ã€å¤šç§Ÿæˆ¶ç’°å¢ƒã€‚                                                                                 |
| âœ… ä½¿ç”¨å…§å»ºçš„ `hakurun` å·¥å…·åœ¨å¢é›†æäº¤*å‰*é€²è¡Œæœ¬åœ°åƒæ•¸æƒæã€‚                                                                  | âŒ ç”¨å¢é›†æäº¤æ›¿ä»£ `hakurun` æœ¬èº« â€“ å®ƒå€‘æœå‹™æ–¼ä¸åŒç›®çš„ï¼ˆæœ¬åœ°åŸ·è¡Œ vs åˆ†æ•£å¼åŸ·è¡Œï¼‰ã€‚                                                  |

---

## âœ¨ åŠŸèƒ½ç‰¹è‰²

* **ç®¡ç† Docker ç’°å¢ƒå·¥ä½œæµç¨‹ï¼š**
    * åœ¨å®¿ä¸»æ©Ÿä¸Šè¨­ç½®æŒä¹…æ€§åŸºç¤å®¹å™¨ï¼ˆ`hakuriver.docker create-container`ï¼‰ã€‚
    * èˆ‡å®¿ä¸»æ©Ÿå®¹å™¨äº’å‹•/å®‰è£è»Ÿé«”ï¼ˆ`hakuriver.docker-shell`ï¼‰ã€‚
    * å°‡ç’°å¢ƒæäº¤ä¸¦æ‰“åŒ…æˆç‰ˆæœ¬åŒ– tarballï¼ˆ`hakuriver.docker create-tar`ï¼‰ã€‚
    * å°‡ tarball æ”¾ç½®åœ¨å…±äº«å„²å­˜ç©ºé–“ä¾›åŸ·è¡Œå™¨ä½¿ç”¨ã€‚
* **å®¹å™¨åŒ–ä»»å‹™åŸ·è¡Œï¼š** ä»»å‹™åœ¨æŒ‡å®šçš„ Docker ç’°å¢ƒä¸­é‹è¡Œï¼ˆ`docker run --rm`ï¼‰ã€‚
* **è‡ªå‹•åŒ–ç’°å¢ƒåŒæ­¥ï¼š** åŸ·è¡Œå™¨åœ¨é‹è¡Œä»»å‹™å‰è‡ªå‹•æª¢æŸ¥ä¸¦å¾å…±äº«å„²å­˜åŒæ­¥æ‰€éœ€çš„å®¹å™¨ tarball ç‰ˆæœ¬ã€‚
* **Systemd å‚™ç”¨åŸ·è¡Œï¼š** å¯é¸æ“‡ä½¿ç”¨ `systemd-run --scope` ç›´æ¥åœ¨ç¯€é»ä¸Šé‹è¡Œä»»å‹™ï¼Œä»¥ç²å¾—ç³»çµ±ç´šè¨ªå•æ¬Šé™æˆ–åœ¨ä¸éœ€è¦ Docker æ™‚ä½¿ç”¨ã€‚
* **CPU/RAM è³‡æºåˆ†é…ï¼š** ä»»å‹™å¯è«‹æ±‚ CPU æ ¸å¿ƒï¼ˆä½œç‚º Docker `--cpus` æˆ– systemd `CPUQuota`ï¼‰å’Œè¨˜æ†¶é«”é™åˆ¶ï¼ˆDocker `--memory` æˆ– systemd `MemoryMax`ï¼‰ã€‚
* **NUMA ç¯€é»å®šä½ï¼ˆSystemd å‚™ç”¨ï¼‰ï¼š** å¯é¸æ“‡ä½¿ç”¨ `numactl` å°‡ *systemd-run* ä»»å‹™ç¶å®šåˆ°ç‰¹å®š NUMA ç¯€é»ã€‚ï¼ˆDocker ä¸­çš„ NUMA æ”¯æ´ä»åœ¨é–‹ç™¼ä¸­ï¼‰ã€‚
* **å¤šç¯€é»/NUMA ä»»å‹™æäº¤ï¼š** é€šéå–®ä¸€è«‹æ±‚åœ¨å¤šå€‹æŒ‡å®šç¯€é»æˆ–ç‰¹å®š NUMA ç¯€é»ä¸Šé‹è¡Œç›¸åŒå‘½ä»¤ï¼ˆåœ¨ Docker å…§æˆ–é€šé systemdï¼‰ã€‚
* **æŒä¹…æ€§ä»»å‹™å’Œç¯€é»è¨˜éŒ„ï¼š** å®¿ä¸»æ©Ÿç¶­è­·ä¸€å€‹ SQLite è³‡æ–™åº«ï¼Œè¨˜éŒ„ç¯€é»ï¼ˆåŒ…æ‹¬æª¢æ¸¬åˆ°çš„ NUMA æ‹“æ’²ï¼‰å’Œä»»å‹™ï¼ˆç‹€æ…‹ã€ç›®æ¨™ã€è³‡æºã€æ—¥èªŒã€ä½¿ç”¨çš„å®¹å™¨ï¼‰ã€‚
* **ç¯€é»å¥åº·å’Œè³‡æºæ„ŸçŸ¥ï¼š** åŸºæœ¬å¿ƒè·³æª¢æ¸¬é›¢ç·šåŸ·è¡Œå™¨ã€‚åŸ·è¡Œå™¨å ±å‘Šæ•´é«” CPU/è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³å’Œ NUMA æ‹“æ’²ã€‚
* **ç¶²é å„€è¡¨æ¿ï¼ˆå¯¦é©—æ€§ï¼‰ï¼š** Vue.js å‰ç«¯ç”¨æ–¼è¦–è¦ºåŒ–ç›£æ§ã€ä»»å‹™æäº¤ï¼ˆåŒ…æ‹¬å¤šç›®æ¨™å’Œå®¹å™¨é¸æ“‡ï¼‰ã€ç‹€æ…‹æª¢æŸ¥å’Œçµ‚æ­¢ä»»å‹™ã€‚
* **ç¨ç«‹åƒæ•¸å±•é–‹å·¥å…·ï¼ˆ`hakurun`ï¼‰ï¼š** ç”¨æ–¼åœ¨æäº¤åˆ°å¢é›†å‰é€²è¡Œæœ¬åœ°åƒæ•¸æƒæçš„å·¥å…·ã€‚

---

## ğŸš€ å¿«é€Ÿå…¥é–€æŒ‡å—

### å‰ç½®éœ€æ±‚

* Python >= 3.10
* ä¸­å¤®ç®¡ç†æ©Ÿå’Œæ‰€æœ‰é‹è¡Œæ©Ÿç¯€é»å‡å¯å­˜å–çš„å…±äº«æª”æ¡ˆç³»çµ±ã€‚
* **ä¸­å¤®ç®¡ç†æ©Ÿç¯€é»ï¼š** å·²å®‰è£ Docker Engineï¼ˆç”¨æ–¼ç®¡ç†ç’°å¢ƒå’Œå»ºç«‹ tarballï¼‰ã€‚
* **é‹è¡Œæ©Ÿç¯€é»ï¼š** å·²å®‰è£ **Docker Engine**ï¼ˆç”¨æ–¼åŸ·è¡Œå®¹å™¨åŒ–ä»»å‹™ï¼‰ã€‚`numactl` ç‚ºå¯é¸ï¼ˆåƒ…åœ¨ä½¿ç”¨ systemd/NUMA å‚™ç”¨æ™‚éœ€è¦ï¼‰ã€‚é‹è¡Œæ©Ÿä½¿ç”¨è€…å¯èƒ½éœ€è¦ç„¡å¯†ç¢¼ `sudo` è¨ªå•æ¬Šé™ï¼Œå–æ±ºæ–¼ Docker è¨­ç½®ï¼ˆ`docker` å‘½ä»¤ï¼‰æˆ–ä½¿ç”¨ systemd å‚™ç”¨æ™‚ï¼ˆ`systemd-run`ã€`systemctl`ï¼‰ã€‚
* **Docker Engine**ï¼šé™¤äº†å®‰è£å¤–ï¼Œæ‚¨ä¸éœ€è¦ä»»ä½•é¡å¤–çš„ Docker é…ç½®ï¼Œä½†è«‹ç¢ºä¿ data-root å’Œå„²å­˜é©…å‹•ç¨‹å¼è¨­ç½®æ­£ç¢ºã€‚HakuRiver ä½¿ç”¨é è¨­çš„ Docker å„²å­˜é©…å‹•ç¨‹å¼å’Œ data-rootï¼ˆ`/var/lib/docker`ï¼‰ï¼Œä½†å¦‚æœ‰éœ€è¦å¯åœ¨ Docker å®ˆè­·ç¨‹å¼é…ç½®ä¸­è®Šæ›´ã€‚é‹è¡Œ `docker run hello-world` ç¢ºèª Docker é‹ä½œæ­£å¸¸ã€‚

### æ­¥é©Ÿ

1. **å®‰è£ HakuRiver**ï¼ˆåœ¨ä¸­å¤®ç®¡ç†æ©Ÿã€é‹è¡Œæ©Ÿå’Œå®¢æˆ¶ç«¯æ©Ÿå™¨ä¸Šï¼‰ï¼š
   ```bash
   # ä½¿ç”¨ pipï¼ˆæ¨è–¦ï¼‰
   python -m pip install hakuriver
   # ä½¿ç”¨ pip å¾ GitHub å®‰è£ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰
   python -m pip install git+https://github.com/KohakuBlueleaf/HakuRiver.git
   # æˆ–å…‹éš†ä¸¦æœ¬åœ°å®‰è£
   # git clone https://github.com/KohakuBlueleaf/HakuRiver.git
   # cd HakuRiver
   # pip install .
   ```

2. **é…ç½® HakuRiver**ï¼ˆåœ¨ä¸­å¤®ç®¡ç†æ©Ÿã€é‹è¡Œæ©Ÿå’Œå®¢æˆ¶ç«¯ä¸Šï¼‰ï¼š
   * å»ºç«‹é è¨­é…ç½®æª”ï¼š
     ```bash
     hakuriver.init config
     ```
   * ç·¨è¼¯é…ç½®æª”ï¼ˆ`~/.hakuriver/config.toml`ï¼‰ï¼š
     ```bash
     vim ~/.hakuriver/config.toml
     ```
   * **é‡è¦**ï¼šè¨­ç½® `host_reachable_address` ç‚ºé‹è¡Œæ©Ÿ/å®¢æˆ¶ç«¯å¯å­˜å–çš„ä¸­å¤®ç®¡ç†æ©Ÿ IP/ä¸»æ©Ÿåã€‚
   * **é‡è¦**ï¼šè¨­ç½® `runner_address` ç‚ºä¸­å¤®ç®¡ç†æ©Ÿå¯å­˜å–çš„é‹è¡Œæ©Ÿ IP/ä¸»æ©Ÿåã€‚
   * **é‡è¦**ï¼šè¨­ç½® `shared_dir` ç‚ºå…±äº«å„²å­˜çš„çµ•å°è·¯å¾‘ï¼ˆä¾‹å¦‚ `/mnt/shared/hakuriver`ï¼‰ã€‚ç¢ºä¿æ­¤ç›®éŒ„å­˜åœ¨ä¸”å¯å¯«å…¥ã€‚
   * æ ¹æ“šéœ€è¦èª¿æ•´å…¶ä»–è¨­ç½®ï¼Œå¦‚é€£æ¥åŸ ã€Docker é è¨­å€¼ç­‰ã€‚ï¼ˆè©³è¦‹ä¸‹æ–¹é…ç½®éƒ¨åˆ†ï¼‰ã€‚

3. **å•Ÿå‹•ä¸­å¤®ç®¡ç†æ©Ÿä¼ºæœå™¨**ï¼ˆåœ¨ç®¡ç†ç¯€é»ä¸Šï¼‰ï¼š
   ```bash
   hakuriver.host
   # ï¼ˆå¯é¸ï¼‰ä½¿ç”¨ç‰¹å®šé…ç½®ï¼šhakuriver.host --config /path/to/host.toml
   ```
   * **å°æ–¼ Systemdï¼š**
     ```bash
     hakuriver.init service --host [--config /path/to/host.toml]
     sudo systemctl restart hakuriver-host.service
     sudo systemctl enable hakuriver-host.service
     ```

4. **å•Ÿå‹•é‹è¡Œæ©Ÿä»£ç†**ï¼ˆåœ¨æ¯å€‹è¨ˆç®—ç¯€é»ä¸Šï¼‰ï¼š
   ```bash
   # ç¢ºä¿ Docker æ­£åœ¨é‹è¡Œä¸”ä½¿ç”¨è€…å¯ä»¥è¨ªå•ï¼Œæˆ–ä½¿ç”¨ç„¡å¯†ç¢¼ sudo åŸ·è¡Œ Docker/Systemd å‘½ä»¤ã€‚
   hakuriver.runner
   # ï¼ˆå¯é¸ï¼‰ä½¿ç”¨ç‰¹å®šé…ç½®ï¼šhakuriver.runner --config /path/to/runner.toml
   ```
   * **å°æ–¼ Systemdï¼š**
     ```bash
     hakuriver.init service --runner [--config /path/to/runner.toml]
     sudo systemctl restart hakuriver-runner.service
     sudo systemctl enable hakuriver-runner.service
     ```

5. **ï¼ˆå¯é¸ï¼‰æº–å‚™ Docker ç’°å¢ƒ**ï¼ˆåœ¨å®¢æˆ¶ç«¯ä¸Šï¼‰ï¼š
   * å»ºç«‹åŸºç¤å®¹å™¨ï¼š`hakuriver.docker create-container python:3.11-slim my-py311-env`
   * å®‰è£è»Ÿé«”ï¼š`hakuriver.docker-shell my-py311-env`ï¼ˆç„¶å¾Œ `pip install ...`ã€`apt install ...`ã€`exit`ï¼‰
   * æ‰“åŒ…ç’°å¢ƒï¼š`hakuriver.docker create-tar my-py311-env`ï¼ˆåœ¨å…±äº«å„²å­˜ä¸­å»ºç«‹ tarballï¼‰

6. **æäº¤æ‚¨çš„ç¬¬ä¸€å€‹ä»»å‹™**ï¼ˆå¾å®¢æˆ¶ç«¯æ©Ÿå™¨ï¼‰ï¼š
   ```bash
   # ä½¿ç”¨é è¨­ Docker ç’°å¢ƒåœ¨ node1 ä¸Šæäº¤ç°¡å–®çš„ echo å‘½ä»¤
   hakuriver.client --target node1 -- echo "Hello HakuRiver!"

   # åœ¨ node2 ä¸Šä½¿ç”¨è‡ªå®šç¾©ç’°å¢ƒå’Œ 2 æ ¸å¿ƒé‹è¡Œ Python æŒ‡ä»¤ç¢¼
   # ï¼ˆå‡è¨­ myscript.py åœ¨å…±äº«ç›®éŒ„ä¸­ï¼‰
   hakuriver.client --target node2 --cores 2 --container my-py311-env -- python /shared/myscript.py --input data.csv
   ```

7. **ç›£æ§å’Œç®¡ç†**ï¼š
   * åˆ—å‡ºç¯€é»ï¼š`hakuriver.client --list-nodes`
   * æª¢æŸ¥ä»»å‹™ç‹€æ…‹ï¼š`hakuriver.client --status <task_id>`
   * çµ‚æ­¢ä»»å‹™ï¼š`hakuriver.client --kill <task_id>`
   * ï¼ˆå¯é¸ï¼‰è¨ªå• Web UIï¼ˆè¦‹å‰ç«¯éƒ¨åˆ†ï¼‰ã€‚

æœ¬æŒ‡å—æä¾›åŸºæœ¬æ­¥é©Ÿã€‚åƒè€ƒä¸‹æ–¹ç« ç¯€ç²å–æœ‰é—œé…ç½®ã€Docker å·¥ä½œæµç¨‹å’Œé€²éšç”¨æ³•çš„è©³ç´°èªªæ˜ã€‚

---

## ğŸ—ï¸ æ¶æ§‹æ¦‚è¿°
![](image/README/HakuRiverArch.jpg)

* **ä¸­å¤®ç®¡ç†æ©Ÿï¼ˆ`hakuriver.host`ï¼‰ï¼š** ä¸­å¤®å”èª¿å™¨ï¼ˆFastAPIï¼‰ã€‚
  * ç®¡ç†ç¯€é»è¨»å†Šï¼ˆåŒ…æ‹¬ NUMA æ‹“æ’²ï¼‰ã€‚
  * ç®¡ç† **Docker ç’°å¢ƒ**ï¼šå»ºç«‹/å•Ÿå‹•/åœæ­¢/åˆªé™¤æŒä¹…æ€§ä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨ï¼Œæäº¤/å»ºç«‹åœ¨å…±äº«å„²å­˜ä¸­çš„ç‰ˆæœ¬åŒ– tarballã€‚
  * æä¾› **WebSocket çµ‚ç«¯æ©Ÿ** è¨ªå•å—ç®¡ç†çš„ä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨ã€‚
  * é€šéå¿ƒè·³è¿½è¹¤ç¯€é»ç‹€æ…‹/è³‡æºã€‚
  * åœ¨ SQLite è³‡æ–™åº«ä¸­å„²å­˜ç¯€é»/ä»»å‹™è³‡è¨Šã€‚
  * æ¥æ”¶ä»»å‹™æäº¤ï¼ˆåŒ…æ‹¬å¤šç›®æ¨™ã€Docker ç’°å¢ƒé¸æ“‡ï¼‰ã€‚
  * é©—è­‰ç›®æ¨™ï¼Œå°‡ä»»å‹™åˆ†é…çµ¦é‹è¡Œæ©Ÿï¼ˆæä¾› Docker æ˜ åƒæ¨™ç±¤æˆ–æŒ‡å®š systemd å‚™ç”¨ï¼‰ã€‚
* **é‹è¡Œæ©Ÿï¼ˆ`hakuriver.runner`ï¼‰ï¼š** è¨ˆç®—ç¯€é»ä¸Šçš„ä»£ç†ï¼ˆFastAPIï¼‰ã€‚
  * éœ€è¦å®‰è£ **Docker Engine**ã€‚
  * å‘ä¸­å¤®ç®¡ç†æ©Ÿè¨»å†Šï¼ˆå ±å‘Šæ ¸å¿ƒæ•¸ã€RAMã€NUMA è³‡è¨Šã€URLï¼‰ã€‚
  * ç™¼é€å®šæœŸå¿ƒè·³ï¼ˆåŒ…æ‹¬ CPU/è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³ï¼‰ã€‚
  * **åŸ·è¡Œä»»å‹™ï¼š**
    * **ä¸»è¦æ–¹å¼ï¼š** æª¢æŸ¥å…±äº«å„²å­˜ä¸­æ˜¯å¦æœ‰æ‰€éœ€çš„å®¹å™¨ tarballï¼Œå¦‚éœ€è¦å‰‡åŒæ­¥ï¼ˆ`docker load`ï¼‰ï¼Œé€šé `docker run --rm` ä½¿ç”¨æŒ‡å®šæ˜ åƒã€è³‡æºé™åˆ¶å’Œæ›è¼‰é‹è¡Œä»»å‹™ã€‚
    * **å‚™ç”¨æ–¹å¼ï¼š** å¦‚æœªæŒ‡å®šå®¹å™¨ï¼Œå‰‡é€šé `sudo systemd-run --scope` é‹è¡Œä»»å‹™ï¼Œè¨­å®šè³‡æºé™åˆ¶å’Œå¯é¸çš„ `numactl` ç¶å®šã€‚
  * å‘ä¸­å¤®ç®¡ç†æ©Ÿå ±å‘Šä»»å‹™ç‹€æ…‹æ›´æ–°ã€‚
  * **éœ€è¦ç„¡å¯†ç¢¼ `sudo`** ç”¨æ–¼ `systemctl`ï¼ˆå¦‚ä½¿ç”¨ systemd å‚™ç”¨ï¼‰æˆ–å¯èƒ½ç”¨æ–¼ `docker` å‘½ä»¤ï¼Œå–æ±ºæ–¼è¨­ç½®ã€‚
* **å®¢æˆ¶ç«¯ï¼ˆ`hakuriver.client`ã€`hakuriver.docker`ã€`hakuriver.docker-shell`ï¼‰ï¼š** CLI å·¥å…·ã€‚
  * èˆ‡ä¸­å¤®ç®¡ç†æ©Ÿé€šä¿¡æäº¤ä»»å‹™ï¼ˆæŒ‡å®šå‘½ä»¤ã€åƒæ•¸ã€è³‡æºã€**Docker å®¹å™¨åç¨±**å’Œ**ä¸€å€‹æˆ–å¤šå€‹ç›®æ¨™**ï¼‰ã€‚
  * æŸ¥è©¢ä»»å‹™/ç¯€é»ç‹€æ…‹ï¼Œç²å–å¥åº·è³‡è¨Šã€‚
  * çµ‚æ­¢/æš«åœ/æ¢å¾©ä»»å‹™ã€‚
  * ç®¡ç†ä¸­å¤®ç®¡ç†æ©Ÿä¸Šçš„ Docker å®¹å™¨å’Œç’°å¢ƒ tarballã€‚
  * å­˜å–ä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨çš„äº’å‹•å¼ shellã€‚
* **å‰ç«¯ï¼š** å¯é¸çš„ç¶²é  UIï¼Œæä¾›é¡ä¼¼å®¢æˆ¶ç«¯çš„è¦–è¦ºåŒ–æ¦‚è¦§å’Œäº’å‹•åŠŸèƒ½ã€‚
* **è³‡æ–™åº«ï¼š** ä¸­å¤®ç®¡ç†æ©Ÿé€šé Peewee ä½¿ç”¨ SQLite å„²å­˜ç¯€é»æ¸…å–®ï¼ˆåŒ…æ‹¬ NUMA æ‹“æ’²ï¼‰å’Œä»»å‹™è©³æƒ…ï¼ˆåŒ…æ‹¬ç›®æ¨™ NUMA IDã€æ‰¹æ¬¡ IDã€ä½¿ç”¨çš„å®¹å™¨ï¼‰ã€‚
* **å„²å­˜ï¼š**
  * **å…±äº«ï¼ˆ`shared_dir`ï¼‰ï¼š** æ›è¼‰åœ¨ä¸­å¤®ç®¡ç†æ©Ÿå’Œæ‰€æœ‰é‹è¡Œæ©Ÿä¸Šã€‚ç”¨æ–¼ **å®¹å™¨ tarball**ã€ä»»å‹™è¼¸å‡ºæ—¥èªŒï¼ˆ`*.out`ã€`*.err`ï¼‰ä»¥åŠå¯èƒ½çš„å…±äº«æŒ‡ä»¤ç¢¼/è³‡æ–™ã€‚
  * **æœ¬åœ°è‡¨æ™‚ï¼ˆ`local_temp_dir`ï¼‰ï¼š** ç¯€é»ç‰¹å®šçš„å¿«é€Ÿå„²å­˜ï¼Œè·¯å¾‘ä½œç‚º `HAKURIVER_LOCAL_TEMP_DIR` ç’°å¢ƒè®Šæ•¸æ³¨å…¥åˆ°ä»»å‹™ä¸­ã€‚

HakuRiver çš„é€šä¿¡æµç¨‹åœ–ï¼š
![](image/README/HakuRiverFlow.jpg)

---

## ğŸ³ åŸºæ–¼ Docker çš„ç’°å¢ƒå·¥ä½œæµç¨‹

HakuRiver ä½¿ç”¨ Docker å®¹å™¨ä½œç‚ºä¾¿æ”œå¼ã€Œè™›æ“¬ç’°å¢ƒã€ã€‚ä»¥ä¸‹æ˜¯å…¸å‹å·¥ä½œæµç¨‹ï¼š

1. **æº–å‚™åŸºç¤ç’°å¢ƒï¼ˆç”±å®¢æˆ¶ç«¯æäº¤ï¼Œä¸­å¤®ç®¡ç†æ©ŸåŸ·è¡Œï¼‰ï¼š**
   * ä½¿ç”¨ `hakuriver.docker create-container <image> <env_name>` å¾åŸºç¤æ˜ åƒï¼ˆå¦‚ `ubuntu:latest`ã€`python:3.11`ï¼‰åœ¨ä¸­å¤®ç®¡ç†æ©Ÿä¸Šå»ºç«‹æŒä¹…å®¹å™¨ã€‚
   * å¦‚æœå®¹å™¨å·²åœæ­¢ï¼Œä½¿ç”¨ `hakuriver.docker start-container <env_name>` å•Ÿå‹•ã€‚
   * ä½¿ç”¨ `hakuriver.docker-shell <env_name>` ç²å–å®¹å™¨å…§çš„äº’å‹•å¼ shellã€‚å®‰è£å¿…è¦çš„å¥—ä»¶ï¼ˆ`apt install ...`ã€`pip install ...`ï¼‰ï¼Œé…ç½®æª”æ¡ˆç­‰ã€‚

2. **æ‰“åŒ…ç’°å¢ƒï¼ˆç”±å®¢æˆ¶ç«¯æäº¤ï¼Œä¸­å¤®ç®¡ç†æ©ŸåŸ·è¡Œï¼‰ï¼š**
   * ç’°å¢ƒè¨­ç½®å®Œæˆå¾Œï¼Œä½¿ç”¨ `hakuriver.docker create-tar <env_name>`ã€‚
   * é€™æœƒå°‡å®¹å™¨ç‹€æ…‹æäº¤åˆ°æ–°çš„ Docker æ˜ åƒï¼ˆ`hakuriver/<env_name>:base`ï¼‰ï¼Œä¸¦å°‡å…¶å„²å­˜ç‚ºå¸¶æ™‚é–“æˆ³çš„ `.tar` æª”æ¡ˆåœ¨é…ç½®çš„ `shared_dir/hakuriver-containers/` ä¸­ã€‚åŒä¸€ç’°å¢ƒçš„èˆŠ tarball æœƒè‡ªå‹•æ¸…ç†ã€‚

3. **é‹è¡Œæ©ŸåŒæ­¥ï¼ˆè‡ªå‹•ï¼‰ï¼š**
   * ç•¶æäº¤ä»»å‹™åˆ°é‹è¡Œæ©Ÿä¸¦æŒ‡å®š `--container <env_name>` æ™‚ï¼Œé‹è¡Œæ©Ÿæœƒæª¢æŸ¥å…¶æœ¬åœ° Docker æ˜ åƒã€‚
   * å¦‚æœæ‰€éœ€æ˜ åƒï¼ˆ`hakuriver/<env_name>:base`ï¼‰ç¼ºå¤±æˆ–æ¯”å…±äº«ç›®éŒ„ä¸­çš„æœ€æ–° tarball èˆŠï¼Œé‹è¡Œæ©Ÿæœƒè‡ªå‹•è¼‰å…¥æœ€æ–°çš„ `.tar` æª”æ¡ˆï¼ˆ`docker load -i ...`ï¼‰ã€‚

4. **ä»»å‹™åŸ·è¡Œï¼ˆåœ¨é‹è¡Œæ©Ÿä¸Šï¼‰ï¼š**
   * é‹è¡Œæ©Ÿä½¿ç”¨ `docker run --rm ...` åœ¨å¾å·²åŒæ­¥çš„ `hakuriver/<env_name>:base` æ˜ åƒå»ºç«‹çš„*è‡¨æ™‚*å®¹å™¨ä¸­åŸ·è¡Œæäº¤çš„å‘½ä»¤ã€‚
   * æ‡‰ç”¨è³‡æºé™åˆ¶ï¼ˆ`--cpus`ã€`--memory`ï¼‰ã€å…±äº«ç›®éŒ„ï¼ˆ`/shared`ï¼‰ã€æœ¬åœ°è‡¨æ™‚ç›®éŒ„ï¼ˆ`/local_temp`ï¼‰å’Œä»»ä½•é¡å¤–æ›è¼‰ã€‚

æ­¤å·¥ä½œæµç¨‹ç¢ºä¿ä»»å‹™åœ¨æ‰€æœ‰ç¯€é»ä¸Šä»¥ä¸€è‡´çš„ã€é é…ç½®çš„ç’°å¢ƒé‹è¡Œï¼Œç„¡éœ€åœ¨æ¯å€‹é‹è¡Œæ©Ÿä¸Šé€²è¡Œæ‰‹å‹•è¨­ç½®ï¼Œåªéœ€å®‰è£ Docker å¼•æ“å³å¯ã€‚

---

## `hakurun`ï¼šæœ¬åœ°åƒæ•¸å±•é–‹å·¥å…·

`hakurun` æ˜¯ä¸€å€‹**æœ¬åœ°è¼”åŠ©å·¥å…·**ï¼Œç”¨æ–¼åœ¨æäº¤åˆ° HakuRiver å¢é›†*å‰*æ¸¬è©¦å…·æœ‰å¤šç¨®åƒæ•¸çµ„åˆçš„å‘½ä»¤æˆ– Python æŒ‡ä»¤ç¢¼ã€‚å®ƒ**ä¸**èˆ‡å¢é›†æœ¬èº«äº’å‹•ã€‚

* **åƒæ•¸å±•é–‹ï¼š**
  * `span:{start..end}` -> æ•´æ•¸ï¼ˆä¾‹å¦‚ `span:{1..3}` -> `1`ã€`2`ã€`3`ï¼‰
  * `span:[a,b,c]` -> åˆ—è¡¨é …ç›®ï¼ˆä¾‹å¦‚ `span:[foo,bar]` -> `"foo"`ã€`"bar"`ï¼‰
* **åŸ·è¡Œï¼š** é‹è¡Œæ‰€æœ‰å±•é–‹åƒæ•¸çš„ç¬›å¡çˆ¾ç©ã€‚ä½¿ç”¨ `--parallel` é€šéæœ¬åœ°å­è™•ç†å¹³è¡Œé‹è¡Œçµ„åˆã€‚
* **ç›®æ¨™ï¼š** é‹è¡Œ Python æ¨¡çµ„ï¼ˆ`mymod`ï¼‰ã€å‡½æ•¸ï¼ˆ`mymod:myfunc`ï¼‰æˆ–å¯åŸ·è¡Œæª”ï¼ˆ`python script.py`ã€`my_executable`ï¼‰ã€‚

**ç¯„ä¾‹ï¼ˆ`demo_hakurun.py`ï¼‰ï¼š**

```python
# demo_hakurun.py
import sys, time, random, os
time.sleep(random.random() * 0.1)
print(f"Args: {sys.argv[1:]}, PID: {os.getpid()}")
```

```bash
# æœ¬åœ°ä¸¦è¡Œé‹è¡Œ 2 * 1 * 2 = 4 å€‹ä»»å‹™
hakurun --parallel python ./demo_hakurun.py span:{1..2} fixed_arg span:[input_a,input_b]
```

ä½¿ç”¨ `hakurun` ç”Ÿæˆå‘½ä»¤ï¼Œä¹‹å¾Œå¯ä»¥ä½¿ç”¨ `hakuriver.client` å€‹åˆ¥æˆ–æ‰¹æ¬¡æäº¤ï¼Œä»¥åœ¨å¢é›†ä¸Šçš„ç‰¹å®š Docker ç’°å¢ƒ*å…§*é‹è¡Œã€‚

---

å™¨ tarball è‡³é—œé‡è¦ã€‚**
  * `[paths] local_temp_dir`ï¼šæœ¬åœ°è‡¨æ™‚å„²å­˜çš„çµ•å°è·¯å¾‘ï¼ˆå¿…é ˆåœ¨åŸ·è¡Œå™¨ç¯€é»å­˜åœ¨ä¸”å¯å¯«å…¥ï¼‰ã€‚æ³¨å…¥åˆ°å®¹å™¨ä¸­ä½œç‚º `/local_temp`ã€‚
  * `[paths] numactl_path`ï¼šåŸ·è¡Œå™¨ç¯€é»ä¸Š `numactl` å¯åŸ·è¡Œæª”çš„çµ•å°è·¯å¾‘ï¼ˆåƒ…åœ¨ä½¿ç”¨ systemd å‚™ç”¨æ™‚éœ€è¦ï¼‰ã€‚
  * `[docker] container_dir`ï¼š`shared_dir` å…§ç”¨æ–¼å®¹å™¨ tarball çš„å­ç›®éŒ„ã€‚
  * `[docker] default_container_name`ï¼šä»»å‹™æäº¤æ™‚æœªæŒ‡å®š `--container` çš„é è¨­ç’°å¢ƒåç¨±ã€‚
  * `[docker] initial_base_image`ï¼šå®¿ä¸»å•Ÿå‹•æ™‚é è¨­ tarball ä¸å­˜åœ¨æ™‚ä½¿ç”¨çš„å…¬å…± Docker æ˜ åƒã€‚
  * `[docker] tasks_privileged`ï¼šé‹è¡Œç‰¹æ¬Šå®¹å™¨çš„é è¨­è¨­ç½®ï¼ˆ`--privileged`ï¼‰ã€‚
  * `[docker] additional_mounts`ï¼šä»»å‹™çš„é è¨­ã€Œä¸»æ©Ÿ:å®¹å™¨ã€æ›è¼‰åˆ—è¡¨ã€‚
  * `[database] db_file`ï¼šå®¿ä¸» SQLite è³‡æ–™åº«çš„è·¯å¾‘ã€‚ç¢ºä¿ç›®éŒ„å­˜åœ¨ã€‚

---

## ğŸ’» ä½¿ç”¨æ–¹æ³• - HakuRiver å¢é›†

æœ¬ç¯€è©³è¿°è¨­ç½®ã€ç®¡ç†ç’°å¢ƒå’Œé‹è¡Œä»»å‹™çš„æ ¸å¿ƒå‘½ä»¤ã€‚

### åˆå§‹è¨­ç½®

éµå¾ªä¸Šæ–¹çš„**å¿«é€Ÿå…¥é–€æŒ‡å—**é€²è¡Œå®‰è£ã€é…ç½®å’Œå•Ÿå‹•ä¸­å¤®ç®¡ç†æ©Ÿ/é‹è¡Œæ©Ÿã€‚

### ç®¡ç† Docker ç’°å¢ƒ

HakuRiver å…è¨±æ‚¨ç›´æ¥ç®¡ç† Docker ç’°å¢ƒï¼Œæ‰“åŒ…å®ƒå€‘ï¼Œä¸¦é€šéå…±äº«å„²å­˜åˆ†ç™¼ã€‚

**Docker ç®¡ç†å‘½ä»¤åƒè€ƒï¼š**

| æ“ä½œ                          | å‘½ä»¤ç¯„ä¾‹                                                      | å‚™è¨»                                                             |
| :---------------------------- | :----------------------------------------------------------- | :-------------------------------------------------------------- |
| åˆ—å‡ºä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨             | `hakuriver.docker list-containers`                           | é¡¯ç¤ºä¸­å¤®ç®¡ç†æ©Ÿä¸Šçš„æŒä¹…å®¹å™¨ã€‚                                    |
| å»ºç«‹ä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨             | `hakuriver.docker create-container <image> <env_name>`       | å¾ `<image>` åœ¨ä¸­å¤®ç®¡ç†æ©Ÿä¸Šå»ºç«‹å®¹å™¨ã€‚                           |
| å•Ÿå‹•ä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨             | `hakuriver.docker start-container <env_name>`                | å¦‚å·²åœæ­¢å‰‡å•Ÿå‹•å®¹å™¨ã€‚                                            |
| åœæ­¢ä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨             | `hakuriver.docker stop-container <env_name>`                 | åœæ­¢å®¹å™¨ã€‚                                                      |
| äº’å‹•å¼ Shell                  | `hakuriver.docker-shell <env_name>`                          | é–‹å•Ÿä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨å…§çš„äº’å‹•å¼ shellã€‚                            |
| å»ºç«‹/æ›´æ–° Tarball              | `hakuriver.docker create-tar <env_name>`                     | æäº¤å®¹å™¨ï¼Œåœ¨ `shared_dir` ä¸­å»ºç«‹/æ›´æ–° tarballã€‚                 |
| åˆ—å‡ºå¯ç”¨ Tarball               | `hakuriver.docker list-tars`                                 | é¡¯ç¤º `shared_dir` ä¸­æ‰“åŒ…çš„ç’°å¢ƒã€‚                                |
| åˆªé™¤ä¸­å¤®ç®¡ç†æ©Ÿå®¹å™¨             | `hakuriver.docker delete-container <env_name>`               | å¾ä¸­å¤®ç®¡ç†æ©Ÿåˆªé™¤æŒä¹…å®¹å™¨ï¼ˆtarball ä¿ç•™ï¼‰ã€‚                      |

### æäº¤å’Œç®¡ç†ä»»å‹™

ä½¿ç”¨ `hakuriver.client` èˆ‡å¢é›†äº’å‹•ã€‚

**ä»»å‹™æäº¤ç¯„ä¾‹ï¼š**

* **åœ¨ node1 ä¸Šä½¿ç”¨è‡ªå®šç¾© Python ç’°å¢ƒé‹è¡ŒæŒ‡ä»¤ç¢¼ï¼š**
  ```bash
  hakuriver.client --target node1 --container my-py311-env -- python /shared/analyze_data.py --input data.csv
  ```
  *ï¼ˆå‡è¨­ `analyze_data.py` åœ¨å®¹å™¨å…§çš„ `/shared/analyze_data.py` å¯è¨ªå•ï¼Œé€šå¸¸æ˜ å°„åˆ°æ‚¨çš„ `shared_dir`ï¼‰*

* **ä½¿ç”¨é è¨­ç’°å¢ƒåœ¨å¤šå€‹ç¯€é»ä¸Šé‹è¡Œå‘½ä»¤ï¼š**
  ```bash
  hakuriver.client --target node1 --target node3 --cores 2 -- memory 512M -- my_processing_tool --verbose /shared/input_file
  ```
  *ï¼ˆä½¿ç”¨é…ç½®ä¸­çš„ `default_container_name`ï¼Œæ¯å€‹ä»»å‹™åˆ†é… 2 æ ¸å¿ƒå’Œ 512MB RAMï¼‰*

* **ç›´æ¥åœ¨ node2 ä¸Šé‹è¡Œç³»çµ±å‘½ä»¤ï¼ˆç„¡ Dockerï¼‰ï¼š**
  ```bash
  hakuriver.client --target node2 --container NULL -- df -h /
  ```

* **åœ¨ node1 çš„ NUMA ç¯€é» 0 ä¸Šé‹è¡Œ systemd ä»»å‹™ï¼š**
  ```bash
  hakuriver.client --target node1:0 --container NULL --cores 4 -- ./run_numa_benchmark.sh
  ```

**ä»»å‹™ç®¡ç†å‘½ä»¤åƒè€ƒï¼š**

| æ“ä½œ                              | å‘½ä»¤ç¯„ä¾‹                                                                               | å‚™è¨»                                                              |
| :-------------------------------- | :------------------------------------------------------------------------------------- | :---------------------------------------------------------------- |
| åˆ—å‡ºç¯€é»                          | `hakuriver.client --list-nodes`                                                        | é¡¯ç¤ºç‹€æ…‹ã€æ ¸å¿ƒæ•¸ã€NUMA æ‘˜è¦ã€‚                                      |
| ç¯€é»å¥åº·                          | `hakuriver.client --health [<node>]`                                                   | ç‰¹å®šç¯€é»æˆ–æ‰€æœ‰ç¯€é»çš„è©³ç´°çµ±è¨ˆè³‡æ–™ã€‚                                 |
| æäº¤ä»»å‹™                          | `hakuriver.client [--target <node[:n]>] [--container <env>] [--cores N] [--] CMD [ARGS...]` | æäº¤ä»»å‹™ã€‚è¦‹ä¸Šæ–¹ç¯„ä¾‹ã€‚                                             |
| æª¢æŸ¥ç‹€æ…‹                          | `hakuriver.client --status <task_id>`                                                  | é¡¯ç¤ºè©³ç´°ç‹€æ…‹ï¼ˆåŒ…æ‹¬ç›®æ¨™ã€æ‰¹æ¬¡ IDã€å®¹å™¨ï¼‰ã€‚                         |
| çµ‚æ­¢ä»»å‹™                          | `hakuriver.client --kill <task_id>`                                                    | è«‹æ±‚çµ‚æ­¢ï¼ˆDocker/systemdï¼‰ã€‚                                       |
| æš«åœä»»å‹™                          | `hakuriver.client pause <task_id>`                                                     | ç™¼é€ SIGSTOP / `docker pause`ã€‚                                   |
| æ¢å¾©ä»»å‹™                          | `hakuriver.client resume <task_id>`                                                    | ç™¼é€ SIGCONT / `docker unpause`ã€‚                                 |
| æäº¤ + ç­‰å¾…                       | `hakuriver.client --wait ...`                                                          | ç­‰å¾…æäº¤çš„ä»»å‹™å®Œæˆã€‚                                               |
| çµåˆ `hakurun`ï¼ˆå¤šå€‹ä½œæ¥­ï¼‰        | `hakurun hakuriver.client --container <env> -- python script.py span:{1..10}`          | æäº¤ 10 å€‹ç¨ç«‹çš„ HakuRiver ä½œæ¥­ã€‚                                  |
| çµåˆ `hakurun`ï¼ˆå–®å€‹ä½œæ¥­ï¼‰        | `hakuriver.client --container <env> -- hakurun --parallel python proc.py span:{A..Z}`   | æäº¤ 1 å€‹åœ¨å…§éƒ¨é‹è¡Œ `hakurun` çš„ HakuRiver ä½œæ¥­ã€‚                  |

**`--target` èªæ³•ï¼š**

| æ ¼å¼                | æè¿°                                    | åŸ·è¡Œæ–¹æ³•å–æ±ºæ–¼ `--container`                  |
| :----------------- | :-------------------------------------- | :-------------------------------------------- |
| `my-node`          | ç›®æ¨™ç‰©ç†ç¯€é» `my-node`ã€‚                | Dockerï¼ˆé è¨­/æŒ‡å®šï¼‰æˆ– systemd                |
| `my-node:0`        | `my-node` ä¸Šçš„ NUMA ç¯€é» 0ã€‚            | Dockerï¼ˆå¿½ç•¥ NUMAï¼‰æˆ– systemdï¼ˆNUMA 0ï¼‰     |
| `another-node:1`   | `another-node` ä¸Šçš„ NUMA ç¯€é» 1ã€‚       | Dockerï¼ˆå¿½ç•¥ NUMAï¼‰æˆ– systemdï¼ˆNUMA 1ï¼‰     |